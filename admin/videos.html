<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion VidÃ©o - H-Lab Admin</title>
    <script src="js/auth-guard.js"></script>
    <script src="js/main.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tech-blue': '#0066FF',
                        'tech-cyan': '#00FFFF',
                        'tech-dark': '#0A0F1C',
                        'tech-gray': '#1A1F2E'
                    }
                }
            }
        }
    </script>
    <style>
        .tech-gradient { background: linear-gradient(135deg, #0066FF 0%, #00FFFF 100%); }
        .tech-glow { box-shadow: 0 0 20px rgba(0, 102, 255, 0.3); }
        .input-focus { transition: all 0.3s ease; }
        .input-focus:focus { border-color: #00FFFF; box-shadow: 0 0 0 3px rgba(0, 255, 255, 0.1); transform: translateY(-2px); }
    </style>
</head>
<body class="bg-tech-dark text-white">
    <!-- Navigation & Sidebar -->
    <nav class="bg-tech-gray border-b border-tech-blue/20">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold tech-gradient bg-clip-text text-transparent">H-Lab Admin</a>
            <div class="flex items-center space-x-4">
                <span class="text-sm text-gray-400" id="adminEmail"></span>
                <button id="logout-button" class="px-4 py-2 border border-red-500 text-red-500 rounded-lg hover:bg-red-500 hover:text-white">DÃ©connexion</button>
            </div>
        </div>
    </nav>
    <div class="flex">
        <aside class="w-64 bg-tech-gray min-h-screen border-r border-tech-blue/20">
            <nav class="p-6">
                <ul class="space-y-2">
                    <li><a href="messages.html" class="block px-4 py-3 hover:bg-tech-blue/10 rounded-lg transition-colors">âœ‰ï¸ Messages</a></li>
                    <li><a href="index.html" class="block px-4 py-3 hover:bg-tech-blue/10 rounded-lg">ğŸ“Š Dashboard</a></li>
                    <li><a href="videos.html" class="block px-4 py-3 bg-tech-blue/20 text-tech-cyan rounded-lg font-semibold">ğŸ¥ VidÃ©os</a></li>
                    <li><a href="formations.html" class="block px-4 py-3 hover:bg-tech-blue/10 rounded-lg">ğŸ“ Formations</a></li>
                    <li><a href="produits.html" class="block px-4 py-3 hover:bg-tech-blue/10 rounded-lg">ğŸ›ï¸ Produits</a></li>
                    <li><a href="partenaires.html" class="block px-4 py-3 hover:bg-tech-blue/10 rounded-lg">ğŸ¤ Partenaires</a></li>
                    <li><a href="temoignages.html" class="block px-4 py-3 hover:bg-tech-blue/10 rounded-lg transition-colors">ğŸ’¬ TÃ©moignages</a></li>
                    <li><a href="projets.html" class="block px-4 py-3 hover:bg-tech-blue/10 rounded-lg transition-colors">ğŸš€ Projets</a></li>
                    <li><a href="equipe.html" class="block px-4 py-3 hover:bg-tech-blue/10 rounded-lg">ğŸ‘¥ Ã‰quipe</a></li>
                    <li><a href="stats.html" class="block px-4 py-3 hover:bg-tech-blue/10 rounded-lg">ğŸ“ˆ Statistiques</a></li>
                    <li><a href="admin-settings.html" class="block px-4 py-3 hover:bg-tech-blue/10 rounded-lg">âš™ï¸ Contact & Adresse</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8">
            <div class="max-w-2xl mx-auto">
                <h1 class="text-3xl font-bold mb-2">VidÃ©o de PrÃ©sentation</h1>
                <p class="text-gray-400 mb-8">GÃ©rez le lien de la vidÃ©o de prÃ©sentation de H-LAB.</p>
                
                <div class="bg-tech-gray rounded-2xl p-8">
                    <form id="videoForm" class="space-y-6">
                        <div>
                            <label for="url" class="block text-sm font-medium mb-2">URL de la vidÃ©o YouTube *</label>
                            <input type="url" id="url" name="url" required class="input-focus w-full p-3 bg-tech-dark/50 border-2 border-gray-600 rounded-lg" placeholder="https://www.youtube.com/watch?v=...">
                        </div>
                        <button type="submit" class="w-full py-3 bg-gradient-to-r from-tech-blue to-tech-cyan text-white font-semibold rounded-lg tech-glow">Enregistrer</button>
                    </form>
                    <div id="notification" class="mt-4 text-center"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_URL = 'https://hlab-api.onrender.com/api';
        const ENDPOINT = '/video';

        async function fetchAPI(endpoint, options = {}) {
            const token = localStorage.getItem('authToken');
            if (!token) { window.location.href = 'login.html?reason=session_expired'; throw new Error('Session expirÃ©e'); }
            const headers = { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` };
            const response = await fetch(`${API_URL}${endpoint}`, { ...options, headers });
            if (response.status === 401) { localStorage.removeItem('authToken'); window.location.href = 'login.html?reason=session_expired'; throw new Error('Session expirÃ©e'); }
            if (!response.ok) { const errorData = await response.json().catch(() => ({ message: `Erreur HTTP ${response.status}` })); throw new Error(errorData.message); }
            return response.status === 204 ? null : response.json();
        }

        async function loadVideoUrl() {
            try {
                const result = await fetchAPI(ENDPOINT);
                if (result && result.data && result.data.url) {
                    document.getElementById('url').value = result.data.url;
                }
            } catch (error) {
                if (error.message.includes('404') || error.message.includes('Aucune vidÃ©o')) {
                    console.info('Aucune vidÃ©o de prÃ©sentation configurÃ©e pour le moment.');
                } else if (error.message !== 'Session expirÃ©e') {
                    showNotification(`Erreur de chargement: ${error.message}`, 'error');
                }
            }
        }

        function showNotification(message, type = 'success') {
            const notifDiv = document.getElementById('notification');
            notifDiv.textContent = message;
            notifDiv.className = type === 'error' ? 'mt-4 text-center text-red-400' : 'mt-4 text-center text-green-400';
            setTimeout(() => notifDiv.textContent = '', 5000);
        }

        document.getElementById('videoForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const url = document.getElementById('url').value;
            try {
                await fetchAPI(ENDPOINT, { method: 'PUT', body: JSON.stringify({ url }) });
                showNotification('URL de la vidÃ©o enregistrÃ©e avec succÃ¨s!');
            } catch (error) {
                if (error.message !== 'Session expirÃ©e') showNotification(`Erreur: ${error.message}`, 'error');
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('adminEmail').textContent = JSON.parse(localStorage.getItem('user'))?.email || 'Admin';
            loadVideoUrl();
        });
    </script>
</body>
</html>